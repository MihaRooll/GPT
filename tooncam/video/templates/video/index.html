<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ToonCam</title>
</head>
<body>
  <video id="video" autoplay playsinline></video>
  <script>
    const ws = new WebSocket('ws://' + window.location.host + '/ws/video/');
    let pc;

    ws.onmessage = async (event) => {
      const data = JSON.parse(event.data);
      if (data.type === 'answer') {
        await pc.setRemoteDescription(data);
      }
    };

    ws.onopen = async () => {
      pc = new RTCPeerConnection();
      pc.ontrack = (ev) => {
        document.getElementById('video').srcObject = ev.streams[0];
      };
      const offer = await pc.createOffer({offerToReceiveVideo: true});
      await pc.setLocalDescription(offer);
      ws.send(JSON.stringify(pc.localDescription));
    };
  </script>
</body>
</html>
